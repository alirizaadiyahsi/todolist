@model IQueryable<tblTask>

<script>
    $(function () {
        $('#tasksTodoList, #tasksDoneList').sortable({
            connectWith: '.dropme',
            stop: function (event, ui) {

                var groupCounts = $('#groups li.active .badge').text().split('/');
                var oldList = $(event.target).attr('id');
                var newList = ui.item.closest('ul.dropme').attr('id');

                // if from done to todo
                if (oldList != newList && newList == 'tasksTodoList') {
                    $('#groups li.active .badge').html((Number(groupCounts[0]) - 1) + '/' + groupCounts[1]);
                    ui.item.children('input[type="checkbox"]').attr('checked', false).trigger('taskStatusChanged');

                    updateTasksOrder();
                }

                // if from todo to done
                if (oldList != newList && newList == 'tasksDoneList') {
                    $('#groups li.active .badge').html((Number(groupCounts[0]) + 1) + '/' + groupCounts[1]);
                    ui.item.children('input[type="checkbox"]').attr('checked', true).trigger('taskStatusChanged');
                }

                // if only change sort
                if (oldList == newList && newList == 'tasksTodoList') {
                    updateTasksOrder();
                }
            }
        });

        //.droppable({
        //    activeClass: 'active',
        //    drop: function (event, ui) {
        //        ui.draggable.appendTo(this);
        //    }
        //})
    });
</script>

<div class="tasks-todo">
    <h4>
        To do:
    </h4>

    <ul class="nav nav-pills nav-stacked dropme" id="tasksTodoList">
        @foreach (var task in Model.Where(x => !x.IsCompleted))
        {
            @Html.Partial("_TaskPartial", task)
        }
    </ul>

    <div class="form-group">
        <form action="@Url.Action("_AddTask","Home")" id="formAddTask">
            <input type="text" class="form-control" name="taskName" id="taskName" placeholder="Add a new task">
        </form>
    </div>
</div>

<hr />

<div class="tasks-done">
    <h4>
        Done:
    </h4>
    <ul class="nav nav-pills nav-stacked dropme" id="tasksDoneList">
        @foreach (var task in Model.Where(x => x.IsCompleted))
        {
            @Html.Partial("_TaskPartial", task)
        }
    </ul>
</div>

@*<div class="tasks-later">
        <h4>
            Later:
        </h4>
        <ul class="nav nav-pills nav-stacked" id="tasksLater">
            @foreach (var task in Model.Where(x => x.IsCompleted))
            {
                @Html.Partial("_TaskLaterPartial", task)
            }
        </ul>
    </div>*@

